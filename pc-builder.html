<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte seu PC - Skylife Tecnologias</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-top">
                <div class="contact-info">
                    <a href="tel:+551199999999"><i class="fas fa-phone"></i> (11) 9999-9999</a>
                    <a href="mailto:contato@skylifetecnologias.com.br"><i class="fas fa-envelope"></i> contato@skylifetecnologias.com.br</a>
                </div>
                <div class="user-actions">
                    <a href="admin/login.html"><i class="fas fa-user"></i> Minha Conta</a>
                    <a href="admin/login.html"><i class="fas fa-sign-in-alt"></i> Login</a>
                    <a href="admin/register.html"><i class="fas fa-user-plus"></i> Cadastre-se</a>
                </div>
            </div>
            <div class="header-main">
                <div class="logo">
                    <a href="index.html">
                        <img src="images/logo.png" alt="Skylife Tecnologias">
                    </a>
                </div>
                <div class="search-bar">
                    <form action="#" method="get">
                        <input type="text" placeholder="Digite o que está buscando...">
                        <button type="submit"><i class="fas fa-search"></i></button>
                    </form>
                </div>
                <div class="cart">
                    <a href="cart.html">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Carrinho | <span id="cartCount">0</span></span>
                    </a>
                </div>
            </div>
        </div>
        <nav>
            <div class="container">
                <div class="nav-menu">
                    <ul>
                        <li><a href="index.html">Início</a></li>
                        <li><a href="categories/hardware.html">Hardware</a></li>
                        <li><a href="categories/perifericos.html">Periféricos</a></li>
                        <li><a href="categories/notebooks.html">Notebooks</a></li>
                        <li><a href="categories/smartphones.html">Smartphones</a></li>
                        <li><a href="pc-builder.html" class="active">Monte seu PC</a></li>
                        <li><a href="support.html">Suporte</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Conteúdo Principal -->
    <main class="container">
        <div class="pc-builder">
            <div class="pc-builder-header">
                <h2>Monte seu PC</h2>
                <p>Selecione os componentes para montar seu computador personalizado</p>
            </div>

            <div class="component-list" id="componentList">
                <div id="componentsLoading" class="loading-indicator" style="text-align: center; padding: 30px;">
                    <i class="fas fa-spinner fa-spin"></i> Carregando componentes...
                </div>
                <!-- Os componentes serão carregados dinamicamente aqui -->
            </div>

            <div class="pc-builder-summary">
                <div class="summary-header">Resumo</div>
                <div id="summary-items">
                    <!-- O resumo será preenchido dinamicamente -->
                </div>
                <div class="summary-total">
                    <span>Total:</span>
                    <span id="total-price">R$0,00</span>
                </div>

                <div class="performance-meter">
                    <div class="performance-title">Desempenho Estimado</div>
                    <div class="performance-bar">
                        <div class="performance-fill" id="performance-fill" style="width: 0%;"></div>
                    </div>
                    <div class="performance-label">
                        <span>Básico</span>
                        <span>Intermediário</span>
                        <span>Avançado</span>
                    </div>
                </div>

                <div id="compatibility-issues" style="margin-top: 20px; color: #f44336; display: none;">
                    <h4><i class="fas fa-exclamation-triangle"></i> Problemas de Compatibilidade</h4>
                    <ul id="issues-list">
                        <!-- Problemas de compatibilidade serão listados aqui -->
                    </ul>
                </div>

                <div class="pc-builder-actions">
                    <button class="btn btn-secondary" id="resetButton">Limpar Seleção</button>
                    <button class="btn btn-primary" id="saveButton">Salvar Configuração</button>
                    <button class="btn btn-primary" id="addToCartButton">Adicionar ao Carrinho</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Institucional</h3>
                    <ul>
                        <li><a href="about.html">Quem Somos</a></li>
                        <li><a href="terms.html">Termos e Condições</a></li>
                        <li><a href="privacy.html">Política de Privacidade</a></li>
                        <li><a href="blog.html">Blog</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Atendimento</h3>
                    <ul>
                        <li><a href="support.html">Central de Suporte</a></li>
                        <li><a href="faq.html">Perguntas Frequentes</a></li>
                        <li><a href="contact.html">Fale Conosco</a></li>
                        <li><a href="returns.html">Trocas e Devoluções</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Minha Conta</h3>
                    <ul>
                        <li><a href="admin/login.html">Meus Pedidos</a></li>
                        <li><a href="admin/login.html">Meus Dados</a></li>
                        <li><a href="admin/login.html">Meus Favoritos</a></li>
                        <li><a href="admin/login.html">Rastrear Pedido</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Formas de Pagamento</h3>
                    <p>Cartões de Crédito, Boleto, Pix</p>
                    <h3>Redes Sociais</h3>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Skylife Tecnologias - Todos os direitos reservados</p>
            </div>
        </div>
    </footer>

    <!-- Modal de Login -->
    <div id="loginModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Login Necessário</h2>
            <p>Para salvar sua configuração ou adicionar ao carrinho, é necessário fazer login.</p>
            <div class="modal-actions">
                <a href="admin/login.html" class="btn btn-primary">Fazer Login</a>
                <button class="btn btn-secondary close-modal">Cancelar</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { getComponentsByType, checkCompatibility, calculatePerformance, calculateTotalPrice, saveConfiguration, addConfigurationToCart } from './js/pcBuilder.js';
        import { getCurrentUser } from './js/auth.js';
        
        // Componentes selecionados
        const selectedComponents = {};
        
        // Tipos de componentes
        const componentTypes = [
            { id: 'cpu', name: 'Processador (CPU)', icon: 'microchip', description: 'O cérebro do seu computador, responsável pelo processamento de dados' },
            { id: 'motherboard', name: 'Placa-mãe', icon: 'server', description: 'Conecta todos os componentes do seu computador' },
            { id: 'ram', name: 'Memória RAM', icon: 'memory', description: 'Armazenamento temporário para dados em uso' },
            { id: 'gpu', name: 'Placa de Vídeo (GPU)', icon: 'tv', description: 'Processa gráficos e imagens para jogos e aplicações' },
            { id: 'storage', name: 'Armazenamento', icon: 'hdd', description: 'Armazena seus arquivos, programas e sistema operacional' },
            { id: 'psu', name: 'Fonte de Alimentação', icon: 'plug', description: 'Fornece energia para todos os componentes' },
            { id: 'case', name: 'Gabinete', icon: 'desktop', description: 'Abriga e protege todos os componentes do seu PC' }
        ];
        
        // Função para formatar valores monetários
        function formatCurrency(value) {
            return `R$${parseFloat(value).toFixed(2).replace('.', ',')}`;
        }
        
        // Função para carregar componentes
        async function loadComponents() {
            const componentList = document.getElementById('componentList');
            const loadingIndicator = document.getElementById('componentsLoading');
            
            try {
                // Limpa a lista de componentes
                componentList.innerHTML = '';
                
                // Para cada tipo de componente
                for (const type of componentTypes) {
                    // Cria o elemento do componente
                    const componentItem = document.createElement('div');
                    componentItem.className = 'component-item';
                    
                    // Adiciona o ícone e detalhes
                    componentItem.innerHTML = `
                        <div class="component-icon">
                            <i class="fas fa-${type.icon}"></i>
                        </div>
                        <div class="component-details">
                            <div class="component-name">${type.name}</div>
                            <div class="component-description">${type.description}</div>
                        </div>
                        <div class="component-select">
                            <select id="${type.id}" data-type="${type.id}">
                                <option value="">Selecione um ${type.name.toLowerCase()}</option>
                                <!-- Opções serão carregadas dinamicamente -->
                            </select>
                        </div>
                    `;
                    
                    // Adiciona à lista
                    componentList.appendChild(componentItem);
                    
                    // Carrega as opções para este tipo de componente
                    await loadComponentOptions(type.id);
                }
                
                // Oculta o indicador de carregamento
                loadingIndicator.style.display = 'none';
                
                // Configura os eventos de seleção
                setupSelectionEvents();
                
            } catch (error) {
                console.error('Erro ao carregar componentes:', error);
                loadingIndicator.innerHTML = `<div class="error-message">Erro ao carregar componentes: ${error.message}</div>`;
            }
        }
        
        // Função para carregar opções de componentes
        async function loadComponentOptions(componentType) {
            try {
                // Busca os componentes do tipo especificado
                const result = await getComponentsByType(componentType);
                
                if (result.success) {
                    const select = document.getElementById(componentType);
                    
                    // Para cada componente, adiciona uma opção
                    result.components.forEach(component => {
                        const option = document.createElement('option');
                        option.value = component.id;
                        option.textContent = `${component.name} - ${formatCurrency(component.price)}`;
                        option.dataset.price = component.price;
                        option.dataset.performance = component.performance_score;
                        
                        // Adiciona atributos específicos para verificação de compatibilidade
                        if (componentType === 'cpu') {
                            option.dataset.socket = component.socket;
                        } else if (componentType === 'motherboard') {
                            option.dataset.socket = component.socket;
                            option.dataset.ramType = component.ram_type;
                        } else if (componentType === 'ram') {
                            option.dataset.type = component.type;
                        } else if (componentType === 'psu') {
                            option.dataset.wattage = component.wattage;
                        }
                        
                        select.appendChild(option);
                    });
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error(`Erro ao carregar opções para ${componentType}:`, error);
                
                // Adiciona opções de exemplo para demonstração
                const select = document.getElementById(componentType);
                
                // Exemplos para cada tipo de componente
                const examples = {
                    cpu: [
                        { id: 'i3-10100', name: 'Intel Core i3-10100 (3.6GHz, 4 núcleos)', price: 699.90, performance: 40, socket: 'LGA1200' },
                        { id: 'i5-11400', name: 'Intel Core i5-11400 (2.6GHz, 6 núcleos)', price: 1299.90, performance: 65, socket: 'LGA1200' },
                        { id: 'i7-11700', name: 'Intel Core i7-11700 (2.5GHz, 8 núcleos)', price: 2199.90, performance: 85, socket: 'LGA1200' },
                        { id: 'ryzen5-3600', name: 'AMD Ryzen 5 3600 (3.6GHz, 6 núcleos)', price: 1199.90, performance: 60, socket: 'AM4' }
                    ],
                    motherboard: [
                        { id: 'h410', name: 'Asus Prime H410M-E (Intel LGA 1200)', price: 499.90, performance: 40, socket: 'LGA1200', ramType: 'DDR4' },
                        { id: 'b560', name: 'Gigabyte B560M DS3H (Intel LGA 1200)', price: 899.90, performance: 65, socket: 'LGA1200', ramType: 'DDR4' },
                        { id: 'a520', name: 'Asus Prime A520M-K (AMD AM4)', price: 599.90, performance: 45, socket: 'AM4', ramType: 'DDR4' }
                    ],
                    ram: [
                        { id: '8gb-2666', name: '8GB DDR4 2666MHz (1x8GB)', price: 299.90, performance: 40, type: 'DDR4' },
                        { id: '16gb-3200', name: '16GB DDR4 3200MHz (2x8GB)', price: 649.90, performance: 70, type: 'DDR4' }
                    ],
                    gpu: [
                        { id: 'gtx1650', name: 'NVIDIA GeForce GTX 1650 4GB', price: 1499.90, performance: 50 },
                        { id: 'rtx3060', name: 'NVIDIA GeForce RTX 3060 12GB', price: 2799.90, performance: 80 }
                    ],
                    storage: [
                        { id: 'ssd240', name: 'SSD 240GB SATA', price: 249.90, performance: 60 },
                        { id: 'nvme500', name: 'SSD NVMe 500GB M.2', price: 499.90, performance: 80 }
                    ],
                    psu: [
                        { id: '500w', name: 'Fonte 500W 80 Plus Bronze', price: 299.90, performance: 40, wattage: 500 },
                        { id: '650w', name: 'Fonte 650W 80 Plus Gold', price: 499.90, performance: 70, wattage: 650 }
                    ],
                    case: [
                        { id: 'basic', name: 'Gabinete Básico ATX', price: 199.90, performance: 40 },
                        { id: 'gaming', name: 'Gabinete Gamer Mid Tower ATX', price: 399.90, performance: 60 }
                    ]
                };
                
                // Adiciona as opções de exemplo
                if (examples[componentType]) {
                    examples[componentType].forEach(example => {
                        const option = document.createElement('option');
                        option.value = example.id;
                        option.textContent = `${example.name} - ${formatCurrency(example.price)}`;
                        option.dataset.price = example.price;
                        option.dataset.performance = example.performance;
                        
                        // Adiciona atributos específicos para verificação de compatibilidade
                        if (componentType === 'cpu') {
                            option.dataset.socket = example.socket;
                        } else if (componentType === 'motherboard') {
                            option.dataset.socket = example.socket;
                            option.dataset.ramType = example.ramType;
                        } else if (componentType === 'ram') {
                            option.dataset.type = example.type;
                        } else if (componentType === 'psu') {
                            option.dataset.wattage = example.wattage;
                        }
                        
                        select.appendChild(option);
                    });
                }
            }
        }
        
        // Configurar eventos de seleção
        function setupSelectionEvents() {
            const selects = document.querySelectorAll('.component-select select');
            
            selects.forEach(select => {
                select.addEventListener('change', function() {
                    const componentType = this.dataset.type;
                    const selectedOption = this.options[this.selectedIndex];
                    
                    if (this.value) {
                        // Adiciona o componente selecionado
                        selectedComponents[componentType] = {
                            id: this.value,
                            name: selectedOption.textContent.split(' - ')[0],
                            price: parseFloat(selectedOption.dataset.price),
                            performance_score: parseInt(selectedOption.dataset.performance)
                        };
                        
                        // Adiciona atributos específicos para verificação de compatibilidade
                        if (componentType === 'cpu') {
                            selectedComponents[componentType].socket = selectedOption.dataset.socket;
                        } else if (componentType === 'motherboard') {
                            selectedComponents[componentType].socket = selectedOption.dataset.socket;
                            selectedComponents[componentType].ram_type = selectedOption.dataset.ramType;
                        } else if (componentType === 'ram') {
                            selectedComponents[componentType].type = selectedOption.dataset.type;
                        } else if (componentType === 'psu') {
                            selectedComponents[componentType].wattage = parseInt(selectedOption.dataset.wattage);
                        }
                    } else {
                        // Remove o componente se a opção vazia for selecionada
                        delete selectedComponents[componentType];
                    }
                    
                    // Atualiza o resumo
                    updateSummary();
                    
                    // Verifica compatibilidade
                    checkComponentCompatibility();
                });
            });
            
            // Configurar botão de reset
            document.getElementById('resetButton').addEventListener('click', resetBuilder);
            
            // Configurar botão de salvar
            document.getElementById('saveButton').addEventListener('click', saveConfiguration);
            
            // Configurar botão de adicionar ao carrinho
            document.getElementById('addToCartButton').addEventListener('click', addToCart);
            
            // Configurar fechamento do modal
            document.querySelectorAll('.close, .close-modal').forEach(element => {
                element.addEventListener('click', function() {
                    document.getElementById('loginModal').style.display = 'none';
                });
            });
        }
        
        // Atualizar resumo
        function updateSummary() {
            const summaryItems = document.getElementById('summary-items');
            const totalPrice = document.getElementById('total-price');
            const performanceFill = document.getElementById('performance-fill');
            
            // Limpa o resumo
            summaryItems.innerHTML = '';
            
            // Adiciona cada componente selecionado ao resumo
            componentTypes.forEach(type => {
                const component = selectedComponents[type.id];
                const summaryItem = document.createElement('div');
                summaryItem.className = 'summary-item';
                
                if (component) {
                    summaryItem.innerHTML = `
                        <span>${type.name}:</span>
                        <span>${component.name}</span>
                    `;
                } else {
                    summaryItem.innerHTML = `
                        <span>${type.name}:</span>
                        <span class="not-selected">Não selecionado</span>
                    `;
                }
                
                summaryItems.appendChild(summaryItem);
            });
            
            // Calcula e atualiza o preço total
            const total = calculateTotalPrice(selectedComponents);
            totalPrice.textContent = formatCurrency(total);
            
            // Calcula e atualiza o desempenho
            const performance = calculatePerformance(selectedComponents);
            performanceFill.style.width = `${performance}%`;
        }
        
        // Verificar compatibilidade entre componentes
        function checkComponentCompatibility() {
            const compatibilityIssues = document.getElementById('compatibility-issues');
            const issuesList = document.getElementById('issues-list');
            
            // Verifica se há componentes suficientes para verificar compatibilidade
            if (Object.keys(selectedComponents).length < 2) {
                compatibilityIssues.style.display = 'none';
                return;
            }
            
            // Verifica compatibilidade
            const compatibility = checkCompatibility(selectedComponents);
            
            if (!compatibility.compatible) {
                // Exibe problemas de compatibilidade
                issuesList.innerHTML = '';
                
                compatibility.issues.forEach(issue => {
                    const li = document.createElement('li');
                    li.textContent = issue;
                    issuesList.appendChild(li);
                });
                
                compatibilityIssues.style.display = 'block';
            } else {
                // Oculta problemas de compatibilidade
                compatibilityIssues.style.display = 'none';
            }
        }
        
        // Resetar o montador
        function resetBuilder() {
            // Limpa os componentes selecionados
            Object.keys(selectedComponents).forEach(key => delete selectedComponents[key]);
            
            // Reseta os selects
            const selects = document.querySelectorAll('.component-select select');
            selects.forEach(select => {
                select.selectedIndex = 0;
            });
            
            // Atualiza o resumo
            updateSummary();
            
            // Oculta problemas de compatibilidade
            document.getElementById('compatibility-issues').style.display = 'none';
        }
        
        // Salvar configuração
        async function saveConfiguration() {
            try {
                // Verifica se há componentes selecionados
                if (Object.keys(selectedComponents).length === 0) {
                    alert('Selecione pelo menos um componente para salvar a configuração.');
                    return;
                }
                
                // Verifica se o usuário está autenticado
                const authResult = await getCurrentUser();
                
                if (!authResult.success || !authResult.user) {
                    // Exibe modal de login
                    document.getElementById('loginModal').style.display = 'block';
                    return;
                }
                
                // Solicita nome para a configuração
                const configName = prompt('Digite um nome para sua configuração:', `Configuração ${new Date().toLocaleDateString()}`);
                
                if (!configName) return; // Usuário cancelou
                
                // Salva a configuração
                const result = await saveConfiguration(authResult.user.id, selectedComponents, configName);
                
                if (result.success) {
                    alert(`Configuração "${configName}" salva com sucesso!`);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Erro ao salvar configuração:', error);
                alert(`Erro ao salvar configuração: ${error.message}`);
            }
        }
        
        // Adicionar ao carrinho
        async function addToCart() {
            try {
                // Verifica se há componentes selecionados
                if (Object.keys(selectedComponents).length === 0) {
                    alert('Selecione pelo menos um componente para adicionar ao carrinho.');
                    return;
                }
                
                // Verifica se todos os componentes foram selecionados
                if (Object.keys(selectedComponents).length < componentTypes.length) {
                    const confirm = window.confirm('Nem todos os componentes foram selecionados. Deseja continuar mesmo assim?');
                    if (!confirm) return;
                }
                
                // Verifica compatibilidade
                const compatibility = checkCompatibility(selectedComponents);
                
                if (!compatibility.compatible) {
                    const confirm = window.confirm('Existem problemas de compatibilidade com esta configuração. Deseja continuar mesmo assim?');
                    if (!confirm) return;
                }
                
                // Verifica se o usuário está autenticado
                const authResult = await getCurrentUser();
                
                if (!authResult.success || !authResult.user) {
                    // Exibe modal de login
                    document.getElementById('loginModal').style.display = 'block';
                    return;
                }
                
                // Adiciona ao carrinho
                // Em um sistema real, isso seria implementado com o Supabase
                // Por enquanto, apenas simula a adição
                
                // Atualiza o contador do carrinho
                const cartCount = document.getElementById('cartCount');
                cartCount.textContent = parseInt(cartCount.textContent) + 1;
                
                alert('Configuração adicionada ao carrinho com sucesso!');
            } catch (error) {
                console.error('Erro ao adicionar ao carrinho:', error);
                alert(`Erro ao adicionar ao carrinho: ${error.message}`);
            }
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Carrega os componentes
            loadComponents();
        });
    </script>
</body>
</html>
